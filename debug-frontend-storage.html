<!DOCTYPE html>
<html>
<head>
    <title>Debug Frontend Storage</title>
</head>
<body>
    <h1>üîç Debug Frontend Terminal Storage</h1>
    <p>This will show where those 148 logs are actually stored.</p>
    
    <button onclick="checkStorage()">üîç Check All Storage</button>
    <button onclick="clearAllStorage()">üßπ Clear All Frontend Storage</button>
    <button onclick="checkAPI()">üåê Check API vs Frontend</button>
    
    <div id="results"></div>
    
    <script>
        function checkStorage() {
            const results = []
            
            // Check localStorage
            try {
                const stored = localStorage.getItem('krypt-terminal-storage')
                if (stored) {
                    const data = JSON.parse(stored)
                    const logCount = data.state?.terminalLogs?.length || 0
                    results.push(`üì¶ localStorage: ${logCount} logs stored in 'terminalLogs'`)
                    
                    if (logCount > 0) {
                        const sampleLog = data.state.terminalLogs[0]
                        results.push(`üìÑ Sample log: ${sampleLog.message} (${new Date(sampleLog.timestamp).toLocaleString()})`)
                    }
                } else {
                    results.push('üì¶ localStorage: No krypt-terminal-storage found')
                }
            } catch (error) {
                results.push(`‚ùå localStorage error: ${error.message}`)
            }
            
            // Check sessionStorage
            try {
                let sessionCount = 0
                for (let i = 0; i < sessionStorage.length; i++) {
                    const key = sessionStorage.key(i)
                    if (key.includes('log') || key.includes('terminal')) {
                        sessionCount++
                        results.push(`üìù sessionStorage: ${key}`)
                    }
                }
                if (sessionCount === 0) {
                    results.push('üìù sessionStorage: No terminal-related data')
                }
            } catch (error) {
                results.push(`‚ùå sessionStorage error: ${error.message}`)
            }
            
            // Check cookies
            const cookies = document.cookie.split(';')
            const terminalCookies = cookies.filter(c => c.includes('terminal') || c.includes('log'))
            if (terminalCookies.length > 0) {
                results.push(`üç™ Cookies: ${terminalCookies.length} terminal-related cookies`)
            } else {
                results.push('üç™ Cookies: No terminal-related cookies')
            }
            
            document.getElementById('results').innerHTML = `
                <div style="background: #f5f5f5; padding: 15px; border-radius: 5px;">
                    <h3>üìä Storage Analysis:</h3>
                    ${results.map(r => `<p>${r}</p>`).join('')}
                </div>
            `
        }
        
        async function checkAPI() {
            try {
                document.getElementById('results').innerHTML = '<p>üîç Comparing API vs Frontend...</p>'
                
                // Get API logs
                const apiResponse = await fetch('https://kryptterminal.com/api/logs?limit=200')
                const apiLogs = await apiResponse.json()
                
                // Get frontend storage
                const stored = localStorage.getItem('krypt-terminal-storage')
                let frontendLogs = []
                if (stored) {
                    const data = JSON.parse(stored)
                    frontendLogs = data.state?.terminalLogs || []
                }
                
                document.getElementById('results').innerHTML = `
                    <div style="background: #f5f5f5; padding: 15px; border-radius: 5px;">
                        <h3>üîç API vs Frontend Comparison:</h3>
                        <p><strong>üåê API Logs:</strong> ${apiLogs.length} logs</p>
                        <p><strong>üíæ Frontend Storage:</strong> ${frontendLogs.length} logs</p>
                        
                        ${frontendLogs.length > apiLogs.length ? `
                            <div style="color: red; font-weight: bold; margin: 10px 0;">
                                ‚ö†Ô∏è ISSUE FOUND: Frontend has ${frontendLogs.length - apiLogs.length} more logs than API!<br>
                                This means the terminal is showing cached logs from browser storage.
                            </div>
                        ` : ''}
                        
                        ${apiLogs.length > 0 ? `
                            <h4>üåê Recent API Logs:</h4>
                            ${apiLogs.slice(0, 3).map(log => `
                                <div style="margin: 5px 0; padding: 8px; border-left: 3px solid blue;">
                                    ${log.message} <small>(${new Date(log.timestamp).toLocaleString()})</small>
                                </div>
                            `).join('')}
                        ` : '<p style="color: green;">‚úÖ API has no logs - backend is clean!</p>'}
                        
                        ${frontendLogs.length > 0 ? `
                            <h4>üíæ Recent Frontend Logs:</h4>
                            ${frontendLogs.slice(-3).map(log => `
                                <div style="margin: 5px 0; padding: 8px; border-left: 3px solid orange;">
                                    ${log.message} <small>(${new Date(log.timestamp).toLocaleString()})</small>
                                </div>
                            `).join('')}
                        ` : '<p style="color: green;">‚úÖ Frontend has no cached logs!</p>'}
                    </div>
                `
                
            } catch (error) {
                document.getElementById('results').innerHTML = `
                    <div style="color: red;">‚ùå Error: ${error.message}</div>
                `
            }
        }
        
        function clearAllStorage() {
            try {
                // Clear localStorage
                localStorage.removeItem('krypt-terminal-storage')
                localStorage.clear()
                
                // Clear sessionStorage
                sessionStorage.clear()
                
                // Clear cookies
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
                
                document.getElementById('results').innerHTML = `
                    <div style="color: green;">
                        ‚úÖ All frontend storage cleared!<br>
                        üîÑ Now refresh kryptterminal.com to see if logs are gone<br>
                        üìä Terminal should now show only fresh API data
                    </div>
                `
                
            } catch (error) {
                document.getElementById('results').innerHTML = `
                    <div style="color: red;">‚ùå Error: ${error.message}</div>
                `
            }
        }
        
        // Auto-check on load
        window.onload = function() {
            checkStorage()
        }
    </script>
</body>
</html>